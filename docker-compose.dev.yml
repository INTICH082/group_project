version: '3.8'  # ← ДОБАВЬТЕ ЭТУ СТРОКУ В НАЧАЛО ФАЙЛА

services:
  redis:
    image: redis:6.2-alpine
    container_name: test-system-redis-dev
    command: redis-server --appendonly yes
    ports:
      - "6379:6379"
    networks:
      - test-network
    restart: unless-stopped

  auth-service:
    build: ./auth
    image: auth-service:dev
    volumes:
      - ./auth:/app
      - /app/vendor
    environment:
      - WATCH_FILES=true
    command: air -c .air.toml
    ports:
      - "8081:8081"
    networks:
      - test-network

  core-service:
    build: ./core
    image: core-service:dev
    volumes:
      - ./core:/app
    environment:
      - DEBUG=true
      - CMAKE_BUILD_TYPE=Debug
    ports:
      - "8082:8082"
    networks:
      - test-network

  web-client:
    build: ./web-client
    image: web-client:dev
    volumes:
      - ./web-client:/app
      - /app/node_modules
    environment:
      - WDS_SOCKET_PORT=0
    ports:
      - "3000:3000"
    networks:
      - test-network

  telegram-bot:
    build: ./telegram-bot
    image: telegram-bot:dev
    volumes:
      - ./telegram-bot:/app
    env_file:
      - ./telegram-bot/.env.docker
    environment:
      - PYTHONUNBUFFERED=1
      - REDIS_URL=redis://test-system-redis-dev:6379/0
      - AUTH_SERVICE_URL=http://auth-service:8081
      - API_BASE_URL=http://core-service:8082
    ports:
      - "8083:8083"
    networks:
      - test-network
    restart: unless-stopped
    depends_on:
      redis:
        condition: service_started
      auth-service:
        condition: service_started

networks:
  test-network:
    external: true
    name: test-system_test-network